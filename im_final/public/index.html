<!DOCTYPE html>
<html lang="en">

<head>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    html,
    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
  <title>Mengzhen's Photo Map</title>
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
<script src='https://momentjs.com/downloads/moment.js'></script>
  <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />
  <link href="https://fonts.googleapis.com/css?family=Chivo" rel="stylesheet">
</head>

<body>
  <style>
    /* time filter */

    .map-overlay {
      font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
      position: absolute;
      width: 25%;
      top: 0;
      left: 0;
      padding: 10px;
    }

    .map-overlay .map-overlay-inner {
      background-color: #fff;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.20);
      border-radius: 3px;
      padding: 10px;
      margin-bottom: 10px;
    }

    .map-overlay h2 {
      line-height: 24px;
      display: block;
      margin: 0 0 10px;
    }

    .map-overlay .legend .bar {
      height: 10px;
      width: 100%;
      background: linear-gradient(to right, #FCA107, #7F3121);
    }

    .map-overlay input {
      background-color: transparent;
      display: inline-block;
      width: 100%;
      position: relative;
      margin: 0;
      cursor: ew-resize;
    }
  </style>
  <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v3.1.1/mapbox-gl-directions.js'></script>
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v3.1.1/mapbox-gl-directions.css' type='text/css' />
  <div id='map'></div>


  <!-- <div class='map-overlay top'>
    <div class='map-overlay-inner'>
      <h2>Significant earthquakes in 2015</h2>
      <label id='month'></label>
      <input id='slider1' type='range' min='0' max='11' step='1' value='0' />
    </div>
    <div class='map-overlay-inner'>
      <div id='legend' class='legend'>
        <div class='bar'></div>
        <div>Magnitude (m)</div>
      </div>
    </div>
  </div> -->

  <div class='map-overlay top'>
    <div class='map-overlay-inner'>
      <h2>Significant earthquakes in 2015</h2>
      <label id='time'></label>
      <input id='slider2' type='range' min='0' max='23' step='1' value='0' />
    </div>
    <div class='map-overlay-inner'>
      <div id='legend' class='legend'>
        <div class='bar'></div>
        <div>Magnitude (m)</div>
      </div>
    </div>
  </div>

  <script src='//d3js.org/d3.v3.min.js' charset='utf-8'></script>


  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiaGFmaXl5YW5kaSIsImEiOiJjamY5dmY1c2gwbXowMnFvZmJlYmVibGd0In0.djzLVWymjTzvRF6XSFM7uQ';
    var filterGroup = document.getElementById('filter-group');

    var map = new mapboxgl.Map({
      container: 'map', // you need this
      style: 'mapbox://styles/mapbox/dark-v9', // you also need this
      center: [-73.977725, 40.760219], // [long, lat] Different than leaflet, different than google maps, same as geojson!
      zoom: 12
    });

    var months = [
      'January',
      'February',
      'March',
      'April',
      'May',
      'June',
      'July',
      'August',
      'September',
      'October',
      'November',
      'December'
    ];

    var times = [
      '0',
      '1',
      '2',
      '3',
      '4',
      '5',
      '6',
      '7',
      '8',
      '9',
      '10',
      '11',
      '12',
      '13',
      '14',
      '15',
      '16',
      '17',
      '18',
      '19',
      '20',
      '21',
      '22',
      '23'
    ];

    function filterBy(time) {
//filter by month
      // var filters = ['==', 'month', month];
      // map.setFilter('allcircles', filters);
      // document.getElementById('month').textContent = months[month];

//filter by time
      var filters = ['==', 'time', time];
      map.setFilter('allcircles', filters);
      document.getElementById('time').textContent = times[time];
    }



    // Source is where the data is coming from, layer is what you're going to do with it.
    map.on('load', function() {

      d3.json('data.geojson', function(err, data) {
        if (err) throw err;

        // Create a month property value based on time
        // used to filter against.
        // data.features = data.features.map(function(d) {
        //   d.properties.month = new Date(d.properties.DATEF).getMonth();
        //   return d;}


          //Create a time property value based on time
          data.features = data.features.map(function(d) {
            var time = d.properties.DATEF +" "+d.properties.TIME+":00";
            var time1 = new Date(time).getHours();
            d.properties.time = (time1);
            // console.log(d.properties.time);
            return d;

        });



        // Add a GeoJSON source containing place coordinates and information.
        map.addSource("dataname", {
          "type": "geojson",
          "data": data
        });

        map.addLayer({
          'id': 'allcircles',
          'type': 'circle',
          'source': 'dataname',
          'paint': {
            'circle-radius': [
                    'interpolate',
                    ['linear'],
                    ['get', 'NUMBER OF PERSONS INJURED'],
                    0, 1.5,
                    27, 40
                ],
            'circle-color': [
                    'interpolate',
                    ['linear'],
                    ['get', 'NUMBER OF PERSONS INJURED'],
                    0, '#ffeda0',
                    10, '#e34a33'
                ],
            'circle-opacity': [
                    'interpolate',
                    ['linear'],
                    ['get', 'NUMBER OF PERSONS INJURED'],
                    0, 0.5,
                    3, 1
                ]
          }
        });

        filterBy(0);

        // document.getElementById('slider1').addEventListener('input', function(e) {
        //   var month = parseInt(e.target.value, 10);
        //   filterBy(month);

          document.getElementById('slider2').addEventListener('input', function(e) {
            var time = parseInt(e.target.value, 10);
            filterBy(time);

          //how many features shown in the layer
          var features = map.queryRenderedFeatures({
            layers: ['allcircles']
          });
          console.log(features.length);
        });
      });
    });
  </script>
</body>

</html>
